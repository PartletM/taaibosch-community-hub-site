<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Taaibosch Community Hub â€” Youth Updates (Prototype)</title>
  <meta name="description" content="Oneâ€‘link hub for news, events, jobs, bursaries, safety, mentors and more." />
  <link rel="icon" sizes="32x32" href="favicon-32.png">
  <link rel="icon" sizes="16x16" href="favicon-16.png">
  <link rel="manifest" href="manifest.webmanifest">
  <style>
    :root{ --bg:#0b1220; --panel:#0f172a; --brand:#22c55e; --text:#e5e7eb; --muted:#94a3b8; --card:#111827; --shadow:0 10px 25px rgba(0,0,0,.25); --radius:18px; --accent:#24A1FF; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial; color:var(--text); background:
      radial-gradient(1200px 600px at 80% -10%, rgba(34,197,94,.15), transparent 60%),
      radial-gradient(800px 400px at 10% 10%, rgba(59,130,246,.12), transparent 60%), var(--bg); display:flex;flex-direction:column;}
    header{position:sticky;top:0;z-index:20;backdrop-filter: blur(8px);background: linear-gradient(180deg, rgba(11,18,32,.9), rgba(11,18,32,.55));border-bottom: 1px solid rgba(148,163,184,.15);}  
    .wrap{max-width:980px;margin:0 auto;padding:14px 16px}
    .brand{display:flex;align-items:center;gap:12px}
    .brand-logo{width:38px;height:38px;border-radius:10px;overflow:hidden;display:flex;align-items:center;justify-content:center;background:#0b1324}
    .brand-logo img{width:100%;height:100%;object-fit:cover;display:block}
    h1{font-size:18px;margin:0}
    .sub{color:var(--muted);font-size:12px;margin-top:2px}
    .bar{display:flex;gap:10px;margin-top:12px}
    input[type="search"],select{flex:1;border:1px solid rgba(148,163,184,.2);background:#0b1324;color:var(--text);padding:12px 14px;border-radius:12px;outline:none}
    .share-btn{padding:12px 14px;border-radius:12px;border:1px solid rgba(148,163,184,.2);background:#0b1324;color:var(--text);cursor:pointer}
    .announcement{background:linear-gradient(90deg, rgba(34,197,94,.18), rgba(34,197,94,.08));border:1px solid rgba(34,197,94,.45);padding:10px 12px;border-radius:12px;margin-top:10px;font-size:14px}
    .hero{margin-top:12px;display:grid;grid-template-columns:1fr;gap:12px}
    .cta-trio{display:grid;grid-template-columns:1fr;gap:10px}
    @media(min-width:760px){.cta-trio{grid-template-columns:1fr 1fr 1fr}}
    .btn{border:1px solid rgba(148,163,184,.25);background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));color:var(--text);padding:14px 16px;border-radius:14px;cursor:pointer;box-shadow:var(--shadow);font-weight:600;text-align:center}
    .btn:hover{transform:translateY(-1px);border-color:rgba(148,163,184,.45)}
    .btn.primary{background:linear-gradient(180deg, rgba(34,197,94,.22), rgba(34,197,94,.08));border-color:rgba(34,197,94,.55)}
    .btn.accent{background:linear-gradient(180deg, rgba(36,161,255,.22), rgba(36,161,255,.08));border-color:rgba(36,161,255,.55)}
    .btn.warn{background:linear-gradient(180deg, rgba(244,63,94,.22), rgba(244,63,94,.08));border-color:rgba(244,63,94,.55)}

    main{flex:1}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;padding:16px}
    @media(min-width:640px){ .grid{grid-template-columns:repeat(3,1fr)} }
    @media(min-width:900px){ .grid{grid-template-columns:repeat(4,1fr)} }
    .card{background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.0));border:1px solid rgba(148,163,184,.15);border-radius:var(--radius);padding:16px;min-height:110px;display:flex;flex-direction:column;justify-content:space-between;box-shadow:var(--shadow);transition: transform .12s ease, border-color .12s ease;cursor:pointer;text-decoration:none;color:inherit}
    .card:hover{transform:translateY(-2px);border-color:rgba(148,163,184,.35)}
    .tag{font-size:12px;color:var(--muted)}
    .title{font-size:16px;font-weight:600;margin-top:6px}
    .cta{margin-top:10px;font-size:13px;color:#a7f3d0}

    .panel{border:1px solid rgba(148,163,184,.15);border-radius:14px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.0));margin-top:8px}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .pillbar{display:flex;gap:8px;flex-wrap:wrap;margin:12px 2px 0}
    .pill{font-size:12px;color:#cbd5e1;border:1px solid rgba(148,163,184,.2);padding:6px 10px;border-radius:999px;cursor:pointer}
    .pill.active{background:#0b1324;border-color:rgba(148,163,184,.5)}

    .kpis{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    @media(min-width:760px){.kpis{grid-template-columns:repeat(4,1fr)}}
    .kpi{border:1px solid rgba(148,163,184,.15);border-radius:12px;padding:12px}
    .kpi .n{font-size:22px;font-weight:700}
    .barwrap{height:10px;background:#0b1324;border-radius:999px;border:1px solid rgba(148,163,184,.2);overflow:hidden}
    .bar{height:100%;background:linear-gradient(90deg, var(--brand), var(--accent))}

    .list{display:grid;grid-template-columns:1fr;gap:10px}
    .item{border:1px solid rgba(148,163,184,.15);border-radius:12px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.0))}
    .item h3{margin:0 0 6px 0;font-size:15px}
    .item p{margin:0;color:#94a3b8;font-size:13px}

    footer{border-top:1px solid rgba(148,163,184,.15);color:var(--muted)}
    .hint{font-size:12px;color:#9ca3af}
    .who{margin-top:6px;text-align:right;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="brand">
        <div class="brand-logo" aria-hidden="true">
          <img src="taaibosch_logo_512.png" alt="Taaibosch Community Hub logo" />
        </div>
        <div>
          <h1>Taaibosch Community Hub</h1>
          <div class="sub">One link for news â€¢ events â€¢ jobs â€¢ bursaries â€¢ safety</div>
        </div>
      </div>
      <div class="bar">
        <input id="search" type="search" placeholder="Search jobs, events, noticesâ€¦" autocomplete="off" />
        <button id="shareBtn" class="share-btn" title="Share">Share</button>
      </div>
      <div id="who" class="who" style="display:none"></div>
      <div class="hero">
        <div id="announcement" class="announcement">ðŸ“£ Welcome! Pin this link in your WhatsApp group description.</div>
        <div class="cta-trio">
          <button class="btn primary" id="btnMember">Community Member</button>
          <button class="btn accent" id="btnStakeholder">Stakeholder</button>
          <button class="btn warn" id="btnAdmin">Admin</button>
        </div>
      </div>
      <div id="pillbar" class="pillbar"></div>
    </div>
  </header>

  <main class="wrap">
    <section id="cards" class="grid"></section>
    <section id="dynamic" style="padding:0 4px 40px 4px;"></section>
  </main>

  <footer>
    <div class="wrap" style="display:flex;justify-content:space-between;align-items:center;padding:16px">
      <div>Â© <span id="year"></span> Taaibosch Community Hub</div>
      <div>Built with â™¥ for our youth</div>
    </div>
  </footer>

  <script>
    // ========================= CONFIG =========================
    const CONFIG = { CV_UPLOAD_URL:'', CV_LIST_URL:'', LISTING_SUBMIT_URL:'', LISTING_LIST_URL:'', LISTING_MOD_URL:'' };
    const USE_REMOTE = !!(CONFIG.CV_UPLOAD_URL && CONFIG.CV_LIST_URL && CONFIG.LISTING_SUBMIT_URL && CONFIG.LISTING_LIST_URL && CONFIG.LISTING_MOD_URL);

    // Stakeholder directory (select before logging in)
    const STAKEHOLDERS = [
      'De Beers Group','Eskom','Blouberg Municipality','Capricorn District','Local Businesses','Masete Primary School','Thokampe Secondary School'
    ];

    // Admin demo creds
    const ADMIN_USER='admin';
    const ADMIN_PASS='admin2025!';

    // Local CV store keys
    const LS_KEYS = { CV_LIST: 'cvList', MIGRATED: 'cvMigratedSingle' };

    // ========================= DEMO DATA =========================
    const DATA = {
      sections: [
        { key:'news', title:'News', items:[
          { t:'New youth center hours', d:'Monâ€“Fri 09:00â€“17:00 (library hall)' },
          { t:'Volunteers needed', d:'Tutors for Grade 12 Maths & Science' }
        ]},
        { key:'events', title:'Events', items:[
          { t:'Career Day', d:'Sat, 25 Oct Â· 10:00 at Community Hall', link:'https://example.org/career-day', tags:['Careers','Youth'] },
          { t:'Clean-up Drive', d:'Sun, 08:00 Â· Meet at Park Entrance', tags:['Community','Volunteer'] },
          { t:'DataForge Africa AI Bootcamp â€” Coming Soon', d:'For high school learners (Grades 8â€“12). Intro to AI, Python basics, and projects. Register interest via the Hub.', tags:['Tech','AI','Youth'] },
          { t:'Saturday Coding Club', d:'Every Sat, 10:00â€“12:00 Â· Library Lab. Bring your laptop if you have one.', tags:['Tech','Coding','Youth'] },
          { t:'Youth Tech Talk: Careers in Data', d:'Thu, 18:00 Â· Community Hall. Guest speakers from local industry.', tags:['Careers','Tech'] }
        ]},
        { key:'jobs', title:'Jobs', items:[
          { t:'Admin Assistant (Intern)', d:'Local clinic Â· Apply by 28 Oct', link:'#', tags:['Admin','Internship'] },
          { t:'Retail Assistant (Part-time)', d:'Mall Â· Weekend shifts', tags:['Retail','Part-time'] }
        ]},
        { key:'bursaries', title:'Bursaries', items:[
          { t:'Municipal Bursary 2026', d:'Opens 1 Nov Â· Prepare certified documents', tags:['Education'] },
          { t:'STEM Scholarship', d:'For Grade 12 with Maths/Science', tags:['STEM','Education'] }
        ]},
        { key:'safety', title:'Safety', items:[
          { t:'Emergency Numbers', d:'10111 Â· 112 Â· Local CPF: 081 000 0000' },
          { t:'Anonymous Tip Line', d:'Use the form link in group description', link:'#' }
        ]},
        { key:'mentors', title:'Mentors', items:[
          { t:'CV & LinkedIn clinic', d:'Wednesdays 16:00â€“18:00, Library Small Room', tags:['Careers'] },
          { t:'Maths tutoring (Grade 10â€“12)', d:'Fridays 15:00â€“17:00', tags:['Education'] }
        ]},
        { key:'sports', title:'Sports', items:[
          { t:'U19 Soccer Trials', d:'Sun, 15:00 Â· Field A', tags:['Soccer','Youth'] },
          { t:'Netball Friday', d:'Every Fri 16:00 Â· Court 2', tags:['Netball'] }
        ]},
        { key:'opps', title:'Opportunities', items:[
          { t:'Free Google Career Certificate', d:'Scholarships available', link:'https://grow.google/certificates/', tags:['Careers','Online'] },
          { t:'Intro to Coding (free)', d:'Register on hub', tags:['Tech','Online'] }
        ]},
        { key:'help', title:'Ask for Help', items:[
          { t:'Airtime/data for school tasks', d:'DM the group admin with proof of need' },
          { t:'Transport assistance', d:'Contact the youth desk for support' }
        ]}
      ],
      youth: [
        {name:'A.', skilled:true, employed:false, role:'Junior Developer', exp:1, qual:'Matric + Cert'},
        {name:'B.', skilled:false, employed:false, role:'â€”', exp:0, qual:'Matric'},
        {name:'C.', skilled:true, employed:true, role:'Retail Assistant', exp:2, qual:'Matric'},
        {name:'D.', skilled:true, employed:false, role:'Admin Intern', exp:0, qual:'Matric + N6'},
        {name:'E.', skilled:false, employed:false, role:'â€”', exp:0, qual:'Grade 11'},
        {name:'F.', skilled:true, employed:true, role:'Technician', exp:3, qual:'Diploma'},
        {name:'G.', skilled:true, employed:false, role:'Data Trainee', exp:0, qual:'Matric + Cert'},
        {name:'H.', skilled:false, employed:false, role:'â€”', exp:0, qual:'Grade 12'},
        {name:'I.', skilled:true, employed:true, role:'Call Centre', exp:1, qual:'Matric'}
      ]
    };

    // ========================= STATE =========================
    let activeKey = location.hash.replace('#','') || 'news';
    let query = '';
    let selectedTag = null;
    let stakeholderAuthed = false; // demo login flag
    let adminAuthed = false;
    let memberName = localStorage.getItem('memberName') || '';
    let stakeholderCompany = localStorage.getItem('stakeholderCompany') || '';

    // ========================= HELPERS =========================
    const $ = sel => document.querySelector(sel);
    function prefersReduced(){return window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;}
    function scrollToDynamic(){const t = document.getElementById('dynamic'); if(!t)return; const h=document.querySelector('header'); const off=(h?h.offsetHeight:0)+8; const y=t.getBoundingClientRect().top + window.scrollY - off; window.scrollTo({top:y, behavior: prefersReduced()? 'auto':'smooth'});}    
    function capitalize(s){ return s.charAt(0).toUpperCase()+s.slice(1);}    

    function renderCards(){
      const cards = $('#cards'); cards.innerHTML='';
      const order = [['news','Updates','News'],['events','Calendar','Events'],['jobs','Work','Jobs'],['bursaries','Education','Bursaries'],['safety','Care','Safety'],['mentors','Support','Mentors'],['sports','Recreation','Sports'],['opps','Growth','Opportunities'],['help','Urgent','Ask for Help']];
      order.forEach(([key, tag, title])=>{
        const a=document.createElement('a'); a.href=`#${key}`; a.className='card'; a.innerHTML=`<div><div class="tag">${tag}</div><div class="title">${title}</div></div><div class="cta">Open â†’</div>`; a.addEventListener('click',(e)=>{e.preventDefault();setActive(key);}); cards.appendChild(a);
      });
      // quick access bar
      const trio = document.createElement('div'); trio.className='panel'; trio.innerHTML=`<div class="row" style="justify-content:space-between;align-items:center"><div><strong>Quick Access</strong><div class="sub">Choose a portal below</div></div><div style="display:flex;gap:8px"><button class="btn primary" id="gMember">Community Member</button><button class="btn accent" id="gStakeholder">Stakeholder</button><button class="btn warn" id="gAdmin">Admin</button></div></div>`; cards.after(trio);
      $('#gMember').addEventListener('click', ()=> openMember()); $('#gStakeholder').addEventListener('click', ()=> openStakeholder()); $('#gAdmin').addEventListener('click', ()=> openAdmin());
      updateSignedInBanner();
    }

    function setActive(key){ activeKey=key; location.hash=key; renderSection(); const ann=$('#announcement'); if(ann) ann.textContent=`ðŸ“£ Viewing: ${capitalize(key)}. Use the search bar to find items quickly.`; scrollToDynamic(); }

    function getActiveSection(){ return DATA.sections.find(s=>s.key===activeKey) || DATA.sections[0]; }
    function uniqueTags(section){ const set=new Set(); (section.items||[]).forEach(i=>(i.tags||[]).forEach(t=>set.add(t))); return Array.from(set).sort(); }

    function renderTagPills(section){ const bar=$('#pillbar'); bar.innerHTML=''; const tags=uniqueTags(section); if(!tags.length) return; const all=document.createElement('span'); all.className='pill'+(selectedTag?'':' active'); all.textContent='All'; all.onclick=()=>{selectedTag=null; renderSection();}; bar.appendChild(all); tags.forEach(t=>{ const pill=document.createElement('span'); pill.className='pill'+(selectedTag===t?' active':''); pill.textContent=t; pill.onclick=()=>{selectedTag=(selectedTag===t?null:t); renderSection();}; bar.appendChild(pill);}); }

    // Filter (kept for tests)
    function filterItems(items,q,tag){ const needle=(q||'').toLowerCase().trim(); return (items||[]).filter(i=>!needle||(i.t||'').toLowerCase().includes(needle)||(i.d||'').toLowerCase().includes(needle)).filter(i=>!tag||(i.tags||[]).includes(tag)); }

    // ========================= MEMBER PORTAL =========================
    function openMember(){
      activeKey='member'; const mount=$('#dynamic'); mount.innerHTML='';
      const h=document.createElement('h2'); h.textContent='Community Member' + (memberName? ' â€” '+memberName : ''); h.style.margin='22px 2px 8px 2px'; h.style.fontSize='18px'; mount.appendChild(h);

      // Member sign-in panel
      const signin=document.createElement('div'); signin.className='panel';
      signin.innerHTML = memberName
        ? `<div class="row" style="align-items:center"><div class="sub">Signed in as <strong>${memberName}</strong></div><button id="changeMemberName" class="btn">Change name</button></div>`
        : `<div class="row" style="align-items:center"><input id="memberNameInput" placeholder="Enter your name to sign in" style="flex:1;min-width:260px" /><button id="setMemberName" class="btn primary">Sign in</button></div>`;
      mount.appendChild(signin);

      const panel=document.createElement('div'); panel.className='panel';
      panel.innerHTML=`
        <p>Upload your CV (PDF or DOC). ${USE_REMOTE? 'Stored in Google Drive/Sheet via Apps Script.' : 'Stored <em>locally</em> in this prototype.'}</p>
        <input type="file" id="cvInput" accept=".pdf,.doc,.docx" />
        <div class="row" style="margin-top:8px"> 
          <input id="cvName" placeholder="Your full name" style="flex:1;min-width:220px" value="${memberName}" />
          <input id="cvEmail" placeholder="Email or phone" style="flex:1;min-width:220px" />
        </div>
        <div class="row" style="margin-top:8px">
          <input id="cvRole" placeholder="Target role (e.g., Retail Assistant, Developer)" style="flex:2;min-width:240px" />
          <input id="cvQual" placeholder="Highest qualification (e.g., Matric, Diploma)" style="flex:2;min-width:240px" />
          <input id="cvExp" type="number" min="0" step="1" placeholder="Years exp" style="width:130px" />
        </div>
        <div class="row" style="margin-top:8px;align-items:center">
          <label style="display:flex;align-items:center;gap:8px"><input type="checkbox" id="cvSkilled" /> Skilled</label>
          <label style="display:flex;align-items:center;gap:8px"><input type="checkbox" id="cvEmployed" /> Employed</label>
        </div>
        <div style="margin-top:8px">
          <button class="btn primary" id="saveCV">${USE_REMOTE? 'Upload to Hub':'Save CV Locally'}</button>
          <button class="btn" id="clearCV">Remove Saved CVs (local)</button>
        </div>
        <div id="cvStatus" class="sub" style="margin-top:8px"></div>
        <div class="hint" style="margin-top:6px">By uploading you agree your CV may be visible to verified stakeholders for recruitment.</div>
      `; mount.appendChild(panel);
      const listPanel=document.createElement('div'); listPanel.className='panel'; listPanel.innerHTML=`<strong>My Submissions</strong><div id="mySubs" class="list" style="margin-top:8px"></div>`; mount.appendChild(listPanel);

      // bind name actions
      const setBtn = document.getElementById('setMemberName');
      if (setBtn) setBtn.onclick = ()=>{ const v=(document.getElementById('memberNameInput').value||'').trim(); if(!v) return; memberName=v; localStorage.setItem('memberName', v); updateSignedInBanner(); openMember(); };
      const chgBtn = document.getElementById('changeMemberName');
      if (chgBtn) chgBtn.onclick = ()=>{ memberName=''; localStorage.removeItem('memberName'); updateSignedInBanner(); openMember(); };

      bindMember(); scrollToDynamic();
    }

    function bindMember(){
      migrateSingleCVToArray();
      const status=$('#cvStatus'), saveBtn=$('#saveCV'), clearBtn=$('#clearCV'), input=$('#cvInput'), subs=$('#mySubs');
      function refreshSubs(){ const arr=getLocalCVs(); subs.innerHTML=''; if(!arr.length){ subs.innerHTML='<div class="item"><p>No CVs saved yet.</p></div>'; return;} arr.forEach(m=>{ const div=document.createElement('div'); div.className='item'; div.innerHTML=`<h3>${m.name||'Unknown'} â€” ${m.filename}</h3><p>${m.contact||''}</p><p class="hint">${m.role||'â€”'} Â· ${m.qual||'â€”'} Â· ${m.exp||0} yrs Â· ${m.skilled? 'Skilled':'Unskilled'} Â· ${m.employed? 'Employed':'Unemployed'}</p><p class="hint">Saved: ${new Date(m.savedAt).toLocaleString()}</p>${m.dataUrl? `<a href="${m.dataUrl}" download="${m.filename}">Download CV</a>`:''}`; subs.appendChild(div); }); }
      saveBtn.onclick=async ()=>{
        const f=input.files && input.files[0]; const name=($('#cvName').value||'').trim(); const contact=($('#cvEmail').value||'').trim(); const role=($('#cvRole').value||'').trim(); const qual=($('#cvQual').value||'').trim(); const exp=parseInt($('#cvExp').value||'0',10)||0; const skilled=$('#cvSkilled').checked; const employed=$('#cvEmployed').checked; if(!f){ status.textContent='Please choose a file first.'; return;} if(!name||!contact){ status.textContent='Please add your name and contact.'; return;}
        if(USE_REMOTE){ status.textContent='Remote upload not configured.'; }
        else{ const reader=new FileReader(); reader.onload=()=>{ try{ const meta={ id:'cv_'+Date.now(), filename:f.name, size:f.size, type:f.type, savedAt:Date.now(), name, contact, role, qual, exp, skilled, employed, dataUrl: reader.result }; const list=getLocalCVs(); list.unshift(meta); localStorage.setItem(LS_KEYS.CV_LIST, JSON.stringify(list)); status.textContent='CV saved locally.'; refreshSubs(); }catch(e){ status.textContent='Could not save. Try a smaller file.'; } }; reader.readAsDataURL(f); }
      };
      clearBtn.onclick=()=>{ localStorage.removeItem(LS_KEYS.CV_LIST); status.textContent='All local CVs removed.'; refreshSubs(); };
      refreshSubs();
    }

    function getLocalCVs(){ try{ const arr=JSON.parse(localStorage.getItem(LS_KEYS.CV_LIST)||'[]'); return Array.isArray(arr)? arr: []; }catch(e){ return []; } }
    function migrateSingleCVToArray(){ if(localStorage.getItem(LS_KEYS.MIGRATED)) return; const meta=JSON.parse(localStorage.getItem('cvMeta')||'null'); const data=localStorage.getItem('cvData'); if(meta){ const arr=getLocalCVs(); arr.unshift({ id:'cv_'+Date.now(), filename: meta.filename, size: meta.size, type: meta.type, savedAt: meta.savedAt||Date.now(), name: meta.name||'', contact: meta.contact||'', role: meta.role||'', qual: meta.qual||'', exp: meta.exp||0, skilled: !!meta.skilled, employed: !!meta.employed, dataUrl: data||'' }); localStorage.setItem(LS_KEYS.CV_LIST, JSON.stringify(arr)); } localStorage.setItem(LS_KEYS.MIGRATED, '1'); }

    // ========================= STAKEHOLDER =========================
    function openStakeholder(){
      activeKey='stakeholder'; const mount=$('#dynamic'); mount.innerHTML=''; const h=document.createElement('h2'); h.textContent='Stakeholder' + (stakeholderAuthed && stakeholderCompany? ' â€” '+stakeholderCompany : ''); h.style.margin='22px 2px 8px 2px'; h.style.fontSize='18px'; mount.appendChild(h);
      if(!stakeholderAuthed){
        const login=document.createElement('div');
        login.className='panel';
        login.innerHTML=`
          <p>Select your organisation, then sign in.</p>
          <div class="item" style="margin-bottom:8px">
            <strong>Choose organisation</strong>
            <div id="orgList" class="pillbar" style="margin-top:8px"></div>
          </div>
          <div class="row">
            <input id="user" placeholder="Username (use: stakeholder)" value="stakeholder" style="flex:1;min-width:200px" />
            <input id="pass" placeholder="Password" type="password" style="flex:1;min-width:200px" />
          </div>
          <div class="row" style="margin-top:8px">
            <input id="company" placeholder="Company (auto-filled from selection)" style="flex:1;min-width:220px" readonly />
            <button class="btn accent" id="doLogin">Login</button>
          </div>
          <div class="sub" id="loginMsg" style="margin-top:6px"></div>`;
        mount.appendChild(login);

        // Build organisation pills
        const orgList = login.querySelector('#orgList');
        let selectedOrg = '';
        STAKEHOLDERS.forEach(name=>{
          const pill=document.createElement('span');
          pill.className='pill';
          pill.textContent=name;
          pill.onclick=()=>{
            selectedOrg=name;
            Array.from(orgList.children).forEach(c=>c.classList.remove('active'));
            pill.classList.add('active');
            login.querySelector('#company').value=name;
          };
          orgList.appendChild(pill);
        });

        $('#doLogin').onclick=()=>{
          const u=($('#user').value||'').trim();
          const p=($('#pass').value||'').trim();
          const c=(selectedOrg || ($('#company').value||'').trim());
          if(u==='stakeholder' && p==='Taaibosch2025!' && c){
            stakeholderAuthed=true; stakeholderCompany=c;
            localStorage.setItem('stakeholderCompany', c);
            updateSignedInBanner();
            openStakeholder();
          } else if(!c){
            $('#loginMsg').textContent='Please choose your organisation above.';
          } else if(!(u==='stakeholder' && p==='Taaibosch2025!')){
            $('#loginMsg').textContent='Invalid credentials.';
          }
        };
        scrollToDynamic();
        return;
      }

      // Dashboard KPIs
      const dash=document.createElement('div'); dash.className='panel'; dash.innerHTML=`<strong>Youth Dashboard</strong><div id="kpis" class="kpis" style="margin-top:8px"></div>`; mount.appendChild(dash);
      const bars=document.createElement('div'); bars.className='panel'; bars.innerHTML=`<strong>Roles & Qualifications</strong><div id="barsWrap" style="margin-top:8px"></div>`; mount.appendChild(bars);

      // CV Browser with filters
      const cv=document.createElement('div'); cv.className='panel'; cv.innerHTML=`
        <strong>Candidate CVs</strong>
        <div class="row" id="cvFilters" style="margin-top:8px">
          <select id="fSkill" style="min-width:150px">
            <option value="">All skills</option>
            <option value="skilled">Skilled</option>
            <option value="unskilled">Unskilled</option>
          </select>
          <select id="fEmp" style="min-width:170px">
            <option value="">All employment</option>
            <option value="employed">Employed</option>
            <option value="unemployed">Unemployed</option>
          </select>
          <input id="fRole" placeholder="Filter by role" style="flex:2;min-width:200px" />
          <select id="fQual" style="min-width:200px"><option value="">All qualifications</option></select>
        </div>
        <div id="cvCounts" class="hint" style="margin-top:6px"></div>
        <div id="cvList" class="list" style="margin-top:8px"></div>`; 
      mount.appendChild(cv);

      // Listing management (stakeholder submits; admin approves)
      const mgmt=document.createElement('div'); mgmt.className='panel'; mgmt.innerHTML=`<strong>Submit items for approval</strong><div class="row" style="margin-top:8px"><button class="btn" id="btnAddJob">Job</button><button class="btn" id="btnAddOpp">Opportunity</button><button class="btn" id="btnAddBur">Bursary</button><button class="btn" id="btnAddNews">News</button><button class="btn" id="btnAddEvent">Event</button><button class="btn" id="btnAddMentor">Mentor</button><button class="btn" id="btnAddSafety">Safety</button></div><div id="formsWrap" style="margin-top:8px"></div><div id="pendingWrap" style="margin-top:8px"></div>`; mount.appendChild(mgmt);

      renderDashboard(); bindCVFilters(); bindListingButtons(); renderPending(false); loadCVs(); scrollToDynamic();
    }

    // Dashboard helpers
    function computeStats(arr){ const total=arr.length; const skilled=arr.filter(x=>x.skilled).length; const unskilled=total-skilled; const employed=arr.filter(x=>x.employed).length; const unemployed=total-employed; const byRole=groupBy(arr.filter(x=>x.role && x.role!=='â€”'),'role'); const byQual=groupBy(arr,'qual'); return { total, skilled, unskilled, employed, unemployed, byRole, byQual }; }
    function groupBy(arr,key){ const m=new Map(); arr.forEach(o=>{ const k=o[key]||'Unknown'; m.set(k,(m.get(k)||0)+1); }); return Array.from(m.entries()).sort((a,b)=>b[1]-a[1]); }
    function pct(n,d){ return d? Math.round((n/d)*100):0; }
    function renderDashboard(){ updateSignedInBanner(); const k=$('#kpis'), b=$('#barsWrap'); const base=DATA.youth.concat(getLocalCVs().map(m=>({ skilled:!!m.skilled, employed:!!m.employed, role:m.role||'â€”', qual:m.qual||'Unknown' }))); const S=computeStats(base); k.innerHTML=''; const kpi=(label,n,p)=>{ const d=document.createElement('div'); d.className='kpi'; d.innerHTML=`<div class="n">${n}</div><div class="sub">${label}</div><div class="barwrap" style="margin-top:8px"><div class="bar" style="width:${p}%"></div></div><div class="sub" style="margin-top:4px">${p}%</div>`; return d; }; k.append(kpi('Total Youth', S.total, 100), kpi('Skilled', S.skilled, pct(S.skilled,S.total)), kpi('Unskilled', S.unskilled, pct(S.unskilled,S.total)), kpi('Employed', S.employed, pct(S.employed,S.total)), kpi('Unemployed', S.unemployed, pct(S.unemployed,S.total))); b.innerHTML=''; const makeBarList=(title,entries)=>{ const wrap=document.createElement('div'); wrap.className='item'; const list=entries.slice(0,8); let html=`<h3>${title}</h3>`; list.forEach(([name,count])=>{ const width=pct(count,S.total); html+=`<div class="row" style="align-items:center;gap:8px"><div style="width:160px">${name}</div><div class="barwrap" style="flex:1"><div class="bar" style="width:${width}%"></div></div><div style="width:40px;text-align:right">${count}</div></div>`; }); wrap.innerHTML=html; return wrap; }; b.append(makeBarList('Top Roles', S.byRole), makeBarList('Qualifications', S.byQual)); }

    // CVs
    async function loadCVs(){
      const listEl=$('#cvList'); const countsEl=$('#cvCounts'); 
      const roleEl=document.getElementById('fRole'); const skillEl=document.getElementById('fSkill'); const empEl=document.getElementById('fEmp'); const qualEl=document.getElementById('fQual');
      const qRole=((roleEl && roleEl.value) || '').toLowerCase().trim();
      const qSkill=(skillEl && skillEl.value) || '';
      const qEmp=(empEl && empEl.value) || '';
      const qQual=(qualEl && qualEl.value) || '';

      let rows=[];
      if(USE_REMOTE){
        try{ const res=await fetch(CONFIG.CV_LIST_URL); rows=await res.json(); }catch(e){ listEl.innerHTML='<div class="item"><p>Could not load CVs.</p></div>'; return; }
      } else {
        rows=getLocalCVs();
      }
      // build qualification options fresh each time
      if(qualEl){ const options=['', ...Array.from(new Set(rows.map(r=>r.qual).filter(Boolean)))]; qualEl.innerHTML=''; options.forEach(q=>{ const opt=document.createElement('option'); opt.value=q; opt.textContent=q? q : 'All qualifications'; qualEl.appendChild(opt); }); qualEl.value=qQual; }

      // filter
      const filtered=rows.filter(r=>{
        if(qSkill==='skilled' && !r.skilled) return false; if(qSkill==='unskilled' && r.skilled) return false;
        if(qEmp==='employed' && !r.employed) return false; if(qEmp==='unemployed' && r.employed) return false;
        if(qQual && (r.qual||'')!==qQual) return false;
        if(qRole && !((r.role||'').toLowerCase().includes(qRole))) return false;
        return true;
      });

      // counts
      const total=rows.length; const skilled=rows.filter(x=>x.skilled).length; const employed=rows.filter(x=>x.employed).length; countsEl.textContent=`${filtered.length} shown Â· ${total} total Â· ${skilled} skilled Â· ${total-skilled} unskilled Â· ${employed} employed Â· ${total-employed} unemployed`;

      // render
      listEl.innerHTML='';
      if(!filtered.length){ listEl.innerHTML='<div class="item"><p>No matching candidates.</p></div>'; return; }
      filtered.forEach(m=>{ const div=document.createElement('div'); div.className='item'; div.innerHTML=`<h3>${m.name||'Unknown'} â€” ${m.filename||''}</h3><p>${m.contact||''}</p><p class="hint">${m.role||'â€”'} Â· ${m.qual||'â€”'} Â· ${m.exp||0} yrs Â· ${m.skilled? 'Skilled':'Unskilled'} Â· ${m.employed? 'Employed':'Unemployed'}</p>${m.dataUrl? `<a href="${m.dataUrl}" download="${m.filename}">Download CV</a>`:''}`; listEl.appendChild(div); });
    }

    function bindCVFilters(){ ['fSkill','fEmp','fRole','fQual'].forEach(id=>{ const el=document.getElementById(id); if(el){ el.addEventListener('input', loadCVs); el.addEventListener('change', loadCVs);} }); }

    // Listings: forms + Admin Approveâ†’Publish
    function bindListingButtons(){
      $('#btnAddJob').onclick=()=> openListingForm('job');
      $('#btnAddOpp').onclick=()=> openListingForm('opportunity');
      $('#btnAddBur').onclick=()=> openListingForm('bursary');
      $('#btnAddNews').onclick=()=> openListingForm('news');
      $('#btnAddEvent').onclick=()=> openListingForm('event');
      $('#btnAddMentor').onclick=()=> openListingForm('mentor');
      $('#btnAddSafety').onclick=()=> openListingForm('safety');
      renderPending(false);
    }

    function openListingForm(type){ const wrap=$('#formsWrap'); const Title={job:'Job',opportunity:'Opportunity',bursary:'Bursary',news:'News',event:'Event',mentor:'Mentor',safety:'Safety'}[type]||'Item'; wrap.innerHTML=`<div class="item"><h3>Submit ${Title}</h3><div class="row"><input id="f_title" placeholder="Title" style="flex:1;min-width:220px" /><input id="f_deadline" placeholder="Deadline (YYYY-MM-DD) â€” optional" style="flex:1;min-width:220px" /></div><div class="row"><input id="f_contact" placeholder="Contact (email/phone)" style="flex:1;min-width:220px" /><input id="f_link" placeholder="Link (optional)" style="flex:1;min-width:220px" /></div><textarea id="f_desc" placeholder="Short description" rows="3" style="width:100%;margin-top:8px"></textarea><div class="row" style="margin-top:8px"><input id="f_tags" placeholder="Tags (comma-separated)" style="flex:1;min-width:220px" /></div><div class="row" style="margin-top:8px"><button class="btn primary" id="submitListing">Submit for Admin Approval</button><div id="formMsg" class="sub"></div></div></div>`; $('#submitListing').onclick=()=> submitListing(type); }

    function validateListing(p){ if(!p.title || !p.desc || !p.contact) return 'Title, description, and contact are required.'; if(p.deadline && !/^\d{4}-\d{2}-\d{2}$/.test(p.deadline)) return 'Deadline must be YYYY-MM-DD'; return ''; }

    async function submitListing(type){ const p={ type, title:($('#f_title').value||'').trim(), desc:($('#f_desc').value||'').trim(), contact:($('#f_contact').value||'').trim(), deadline:($('#f_deadline').value||'').trim(), link:($('#f_link').value||'').trim(), tags:($('#f_tags').value||'').split(',').map(s=>s.trim()).filter(Boolean), org: stakeholderCompany || 'Unknown Org' }; const msg=$('#formMsg'); const err=validateListing(p); if(err){ msg.textContent=err; return; }
      if(USE_REMOTE){ try{ const res=await fetch(CONFIG.LISTING_SUBMIT_URL,{ method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(p)}); if(!res.ok) throw new Error('Network'); msg.textContent='Submitted for admin approval.'; }catch(e){ msg.textContent='Submit failed.'; } }
      else{ const arr=JSON.parse(localStorage.getItem('pendingListings')||'[]'); arr.push({ ...p, id:'l_'+Date.now() }); localStorage.setItem('pendingListings', JSON.stringify(arr)); msg.textContent='Submitted (awaiting admin).'; renderPending(false); }
    }

    function renderPending(isAdmin){ const wrap=$('#pendingWrap'); const pending = USE_REMOTE? [] : JSON.parse(localStorage.getItem('pendingListings')||'[]'); const approved = USE_REMOTE? [] : JSON.parse(localStorage.getItem('approvedListings')||'[]'); let html=`<div class="item"><h3>Pending ${isAdmin? 'â€” Approve or Reject':'(awaiting admin)'}</h3>`; if(!USE_REMOTE && !pending.length) html += '<p class="hint">No pending items.</p>'; pending.forEach(p=>{ html+=renderListingRow(p,isAdmin); }); html+='</div>'; html+=`<div class="item" style="margin-top:8px"><h3>Published</h3>`; if(!USE_REMOTE && !approved.length) html+='<p class="hint">No published items yet.</p>'; approved.forEach(p=>{ html+=renderListingRow(p,false); }); html+='</div>'; wrap.innerHTML=html; if(isAdmin && !USE_REMOTE){ pending.forEach(p=>{ const a=$(`#approve_${p.id}`); if(a) a.onclick=()=> approveListing(p.id); const r=$(`#reject_${p.id}`); if(r) r.onclick=()=> rejectListing(p.id); }); }
    }

    function renderListingRow(p,canAct){ const tag=p.tags && p.tags.length? (' Â· '+p.tags.join(', ')) : ''; const org=p.org? ` Â· <span class="hint">${p.org}</span>`:''; return `<div class="row" style="align-items:flex-start;gap:8px"><div style="flex:1"><strong>${p.title}</strong><div class="hint">${p.type.toUpperCase()}${tag}${org}</div><div>${p.desc}</div><div class="hint">Contact: ${p.contact}${p.deadline? ' Â· Deadline: '+p.deadline : ''}${p.link? ' Â· <a href=\"'+p.link+'\" target=\"_blank\">Link</a>':''}</div></div><div style="display:flex;gap:6px">${canAct? `<button class="btn primary" id="approve_${p.id}">Approve</button><button class="btn" id="reject_${p.id}">Reject</button>` : ''}</div></div>`; }

    function approveListing(id){ const pending=JSON.parse(localStorage.getItem('pendingListings')||'[]'); const approved=JSON.parse(localStorage.getItem('approvedListings')||'[]'); const idx=pending.findIndex(x=>x.id===id); if(idx>-1){ const [p]=pending.splice(idx,1); approved.push(p); localStorage.setItem('pendingListings', JSON.stringify(pending)); localStorage.setItem('approvedListings', JSON.stringify(approved)); mergeApprovedIntoSections(); const isAdminView = activeKey==='admin'; if(isAdminView) renderPending(true); else renderPending(false); } }
    function rejectListing(id){ const pending=JSON.parse(localStorage.getItem('pendingListings')||'[]'); const idx=pending.findIndex(x=>x.id===id); if(idx>-1){ pending.splice(idx,1); localStorage.setItem('pendingListings', JSON.stringify(pending)); const isAdminView = activeKey==='admin'; if(isAdminView) renderPending(true); else renderPending(false); } }

    function mergeApprovedIntoSections(){ if(USE_REMOTE) return; const approved=JSON.parse(localStorage.getItem('approvedListings')||'[]'); const map={ job:'jobs', opportunity:'opps', bursary:'bursaries', news:'news', event:'events', mentor:'mentors', safety:'safety' };
      // Clear previously injected
      Object.values(map).forEach(k=>{ const sec=DATA.sections.find(s=>s.key===k); if(!sec) return; sec.items = (sec.items||[]).filter(it=>!it._approved); });
      // Inject approved
      approved.forEach(p=>{ const k=map[p.type]||'opps'; const sec=DATA.sections.find(s=>s.key===k); if(!sec) return; const item={ t:p.title, d:p.desc + (p.deadline? ` Â· Deadline: ${p.deadline}`:''), link:p.link||'', tags:p.tags||[], _approved:true }; (sec.items=sec.items||[]).unshift(item); }); }

    // ========================= ADMIN =========================
    function openAdmin(){
      activeKey='admin'; const mount=$('#dynamic'); mount.innerHTML=''; const h=document.createElement('h2'); h.textContent='Admin'; h.style.margin='22px 2px 8px 2px'; h.style.fontSize='18px'; mount.appendChild(h);
      if(!adminAuthed){ const login=document.createElement('div'); login.className='panel'; login.innerHTML=`<p>Admin login</p><div class="row"><input id="a_user" placeholder="Username" value="admin" style="flex:1;min-width:200px" /><input id="a_pass" placeholder="Password" type="password" style="flex:1;min-width:200px" /></div><div class="row" style="margin-top:8px"><button class="btn warn" id="a_login">Login</button></div><div class="sub" id="a_msg" style="margin-top:6px"></div>`; mount.appendChild(login); $('#a_login').onclick=()=>{ const u=($('#a_user').value||'').trim(); const p=($('#a_pass').value||'').trim(); if(u===ADMIN_USER && p===ADMIN_PASS){ adminAuthed=true; updateSignedInBanner(); openAdmin(); } else { $('#a_msg').textContent='Invalid admin credentials.'; } }; scrollToDynamic(); return; }

      const mgmt=document.createElement('div'); mgmt.className='panel'; mgmt.innerHTML=`<strong>Pending items (global)</strong><div id="pendingWrap" style="margin-top:8px"></div>`; mount.appendChild(mgmt);
      const pub=document.createElement('div'); pub.className='panel'; pub.innerHTML=`<strong>Published items</strong><div id="publishedWrap" style="margin-top:8px"></div>`; mount.appendChild(pub);

      // Reuse rendering
      renderPending(true);
      // Also show published list alone
      const approved = USE_REMOTE? [] : JSON.parse(localStorage.getItem('approvedListings')||'[]');
      const publishedWrap = $('#publishedWrap');
      if(!approved.length){ publishedWrap.innerHTML = '<div class="item"><p class="hint">Nothing published yet.</p></div>'; }
      else { publishedWrap.innerHTML = approved.map(p=> `<div class="item"><strong>${p.title}</strong><div class="hint">${p.type.toUpperCase()} Â· ${p.org||'Unknown Org'}</div><div>${p.desc}</div></div>`).join(''); }

      scrollToDynamic();
    }

    // ========================= SECTION RENDERER =========================
    function renderSection(){ const mount=$('#dynamic'); if(activeKey==='member'){ openMember(); return; } if(activeKey==='stakeholder'){ openStakeholder(); return; } if(activeKey==='admin'){ openAdmin(); return; }
      mergeApprovedIntoSections(); const sec=getActiveSection(); renderTagPills(sec); const items=filterItems(sec.items||[], query, selectedTag);
      mount.innerHTML=''; const h=document.createElement('h2'); h.textContent=sec.title; h.style.margin='22px 2px 8px 2px'; h.style.fontSize='18px'; mount.appendChild(h);
      const list=document.createElement('div'); list.className='list'; items.forEach(it=>{ const div=document.createElement('div'); div.className='item'; const linkHTML=it.link? `<a href="${it.link}" target="_blank" rel="noopener">Open link â†’</a>`:''; div.innerHTML=`<h3>${it.t||''}</h3><p>${it.d||''}</p>${linkHTML}`; list.appendChild(div); }); if(!items.length){ const empty=document.createElement('div'); empty.className='item'; empty.innerHTML='<p>No items yet. Ask an admin to add some here.</p>'; list.appendChild(empty);} mount.appendChild(list);
    }

    function updateSignedInBanner(){ const el=$('#who'); if(!el) return; let text=''; if(adminAuthed){ text = 'Signed in as Admin'; } else if(stakeholderAuthed && stakeholderCompany){ text = `Signed in as Stakeholder: ${stakeholderCompany}`; } else if(memberName){ text = `Signed in as Member: ${memberName}`; } el.textContent = text; el.style.display = text? 'block':'none'; }

    // ========================= SHARE & TESTS =========================
    async function doShare(){ const shareBtn=$('#shareBtn'); try{ if(navigator.share){ await navigator.share({ title: document.title, text: 'Taaibosch Community Hub â€” Youth Updates', url: location.href }); } else { await navigator.clipboard.writeText(location.href); if(shareBtn){ shareBtn.textContent='Link Copied'; setTimeout(()=> shareBtn.textContent='Share', 1600); } } }catch(e){ console.warn(e); } }

    function runTests(){
      const jobs=DATA.sections.find(s=>s.key==='jobs').items; const events=DATA.sections.find(s=>s.key==='events').items;
      console.assert(filterItems(jobs,'admin',null).length===1,'Test: search title (admin) should return 1');
      console.assert(filterItems(jobs,'mall',null).length===1,'Test: search desc (mall) should return 1');
      console.assert(filterItems(jobs,'', 'Internship').length===1,'Test: tag Internship should return 1');
      console.assert(filterItems(jobs,'admin','Internship').length===1,'Test: admin + Internship returns 1');
      console.assert(filterItems(events,'nonexistent',null).length===0,'Test: nonexistent query returns 0');
      // CV filters & validation tests
      const demo=[{skilled:true,employed:false,role:'Dev',qual:'Matric'},{skilled:false,employed:true,role:'Retail',qual:'Diploma'}];
      const skilledCount=demo.filter(x=>x.skilled).length; console.assert(skilledCount===1,'CV test: skilled count');
      const err1=validateListing({title:'x',desc:'',contact:''}); console.assert(!!err1,'Listing validation should fail without desc/contact');
      const err2=validateListing({title:'x',desc:'y',contact:'z',deadline:'2025-13-40'}); console.assert(!!err2,'Deadline format invalid');
      const err3=validateListing({title:'x',desc:'y',contact:'z',deadline:'2025-10-15'}); console.assert(!err3,'Deadline ok');
      // Stakeholder list sanity
      console.assert(Array.isArray(STAKEHOLDERS) && STAKEHOLDERS.includes('Eskom') && STAKEHOLDERS.length>=7, 'Stakeholder directory present');
      // Admin login sanity
      console.assert(ADMIN_USER==='admin' && ADMIN_PASS==='admin2025!','Admin creds set');
      // Mapping sanity
      const map={ job:'jobs', opportunity:'opps', bursary:'bursaries', news:'news', event:'events', mentor:'mentors', safety:'safety' };
      Object.entries(map).forEach(([t,k])=>{ console.assert(DATA.sections.some(s=>s.key===k), `Section exists for ${t}`); });
      // Extra
      const tagRes = filterItems(jobs,'','Retail'); console.assert(tagRes.length===1 && tagRes[0].t.includes('Retail'),'Tag filter should work for Retail');
      console.assert(pct(1,4)===25 && pct(0,0)===0,'pct function basic checks');
    }

    // ========================= INIT =========================
    window.addEventListener('DOMContentLoaded', ()=>{
      const y=document.getElementById('year'); if(y) y.textContent=new Date().getFullYear();
      renderCards();
      setActive(activeKey);
      const share=document.getElementById('shareBtn'); if(share) share.addEventListener('click', doShare);
      const s=document.getElementById('search'); if(s) s.addEventListener('input',(e)=>{ query=(e.target.value||'').toLowerCase().trim(); renderSection(); });
      document.getElementById('btnMember').addEventListener('click', ()=> openMember());
      document.getElementById('btnStakeholder').addEventListener('click', ()=> openStakeholder());
      document.getElementById('btnAdmin').addEventListener('click', ()=> openAdmin());
      updateSignedInBanner();
      const params=new URLSearchParams(location.search); if(params.get('test')!=='0'){ try{ runTests(); console.log('%cAll tests passed','color:#22c55e'); }catch(err){ console.error('Test failure', err); } }
    });

    window.addEventListener('hashchange', ()=>{ setActive(location.hash.replace('#','')||'news'); });
  </script>
</body>
</html>
